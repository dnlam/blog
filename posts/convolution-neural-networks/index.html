<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-05-10">

<title>Building SoTA Convolution Neural Networks for Image Recognition – Lam Dinh</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-befe23ebd2f54d8af2c8a89d1a1611f1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1688d9e1630bd0bcb1ec498477fd8fb7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Lam Dinh</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/lam-dinh-34a66a160/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://dnlam.github.io"> <i class="bi bi-globe" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:nlam.dinh@gmail.com"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Building SoTA Convolution Neural Networks for Image Recognition</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">CNN</div>
                <div class="quarto-category">code</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 10, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#overview-of-convolution-neural-networks-cnn" id="toc-overview-of-convolution-neural-networks-cnn" class="nav-link" data-scroll-target="#overview-of-convolution-neural-networks-cnn">Overview of Convolution Neural Networks (CNN)</a>
  <ul class="collapse">
  <li><a href="#convolution-layer" id="toc-convolution-layer" class="nav-link" data-scroll-target="#convolution-layer">Convolution Layer</a></li>
  <li><a href="#strides-and-padding" id="toc-strides-and-padding" class="nav-link" data-scroll-target="#strides-and-padding">Strides and Padding</a></li>
  <li><a href="#create-a-convolution-layer-with-pytorch" id="toc-create-a-convolution-layer-with-pytorch" class="nav-link" data-scroll-target="#create-a-convolution-layer-with-pytorch">Create a Convolution Layer with PyTorch</a></li>
  <li><a href="#improving-training-stability" id="toc-improving-training-stability" class="nav-link" data-scroll-target="#improving-training-stability">Improving Training Stability</a>
  <ul class="collapse">
  <li><a href="#increase-batch-size" id="toc-increase-batch-size" class="nav-link" data-scroll-target="#increase-batch-size">Increase Batch Size</a></li>
  <li><a href="#learning-rate-finder" id="toc-learning-rate-finder" class="nav-link" data-scroll-target="#learning-rate-finder">Learning Rate Finder</a></li>
  <li><a href="#batch-normalization" id="toc-batch-normalization" class="nav-link" data-scroll-target="#batch-normalization">Batch Normalization</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#residual-networks-resnet" id="toc-residual-networks-resnet" class="nav-link" data-scroll-target="#residual-networks-resnet">Residual Networks (ResNet)</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="overview" class="level1">
<h1>Overview</h1>
<p>In this blog post, we will explore the architecture of Convolution Neural Networks (CNN) and how they have been used to achieve state-of-the-art performance in image recognition tasks. We will also discuss some of the key components of CNNs, such as convolution layers, pooling layers, and activation functions. Finally, we will look at one of the most popular CNN architectures: <code>ResNet</code>.</p>
</section>
<section id="overview-of-convolution-neural-networks-cnn" class="level1">
<h1>Overview of Convolution Neural Networks (CNN)</h1>
<p>In the context of computer vision, <strong>feature engineering</strong> is the process of using domain knowledge to extract distinctive attributes from images that can be used to improve the performance of machine learning algorithms. For instance, in image classification tasks, the number 7 is characterized by a horizontal edge near the top, and a diagonal line that goes down to the right. These features can be used to distinguish the number 7 from other digits.</p>
<p>It turns out that finding the edges in an image is a crucial step in computer vision tasks. To achieve this, we can use a technique called <strong>convolution</strong>. Convolution is a mathematical operation that takes two inputs: an image and a filter (also known as a kernel). The filter is a small matrix that is used to scan the image and extract features. For example, the following filter can be used to detect horizontal edges in an image.</p>
<section id="convolution-layer" class="level2">
<h2 class="anchored" data-anchor-id="convolution-layer">Convolution Layer</h2>
<p>A convolution layer applies a set of filters (i.e., <strong>kernel</strong>) to the input image to extract features. Each filter/kernel is a small matrix that is used to scan the image and extract features. The output of a convolution layer is a set of feature maps, which are the result of applying each filter to the input image.</p>
<div id="fig-kernel" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kernel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./imgs/kernel.png" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kernel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: An example of kernel
</figcaption>
</figure>
</div>
<p>As illustrated in Figure <a href="#fig-kernel" class="quarto-xref">Figure&nbsp;1</a>, a 3x3 matrix kernel is applied to the input image, which is 7x7 grid. The kernel is applied to each pixel in the image, and the output is a new pixel value that is calculated by taking the dot product of the kernel and the corresponding pixels in the image. This process is repeated for each pixel in the image, resulting in a new feature map.</p>
<p>Let’s take another look at how convolution works in practice. We will use the <code>im3</code> image, which is a 28x28 grayscale image of the digit 3 from the MNIST dataset. We will apply a 3x3 kernel to the image to extract features.</p>
<div id="fa4b133e" class="cell" data-cache="true" data-message="false" data-execution_count="3">
<div class="cell-output cell-output-display" data-execution_count="2">
<style type="text/css">
#T_90ffa_row0_col0, #T_90ffa_row0_col1, #T_90ffa_row0_col2, #T_90ffa_row0_col3, #T_90ffa_row0_col4, #T_90ffa_row0_col5, #T_90ffa_row0_col6, #T_90ffa_row0_col7, #T_90ffa_row0_col8, #T_90ffa_row0_col9, #T_90ffa_row0_col10, #T_90ffa_row0_col11, #T_90ffa_row0_col12, #T_90ffa_row0_col13, #T_90ffa_row0_col14, #T_90ffa_row0_col15, #T_90ffa_row0_col16, #T_90ffa_row0_col17, #T_90ffa_row0_col18, #T_90ffa_row0_col19, #T_90ffa_row0_col20, #T_90ffa_row0_col21, #T_90ffa_row0_col22, #T_90ffa_row0_col23, #T_90ffa_row0_col24, #T_90ffa_row0_col25, #T_90ffa_row0_col26, #T_90ffa_row0_col27, #T_90ffa_row1_col0, #T_90ffa_row1_col1, #T_90ffa_row1_col2, #T_90ffa_row1_col3, #T_90ffa_row1_col4, #T_90ffa_row1_col5, #T_90ffa_row1_col6, #T_90ffa_row1_col7, #T_90ffa_row1_col8, #T_90ffa_row1_col9, #T_90ffa_row1_col10, #T_90ffa_row1_col11, #T_90ffa_row1_col12, #T_90ffa_row1_col13, #T_90ffa_row1_col14, #T_90ffa_row1_col15, #T_90ffa_row1_col16, #T_90ffa_row1_col17, #T_90ffa_row1_col18, #T_90ffa_row1_col19, #T_90ffa_row1_col20, #T_90ffa_row1_col21, #T_90ffa_row1_col22, #T_90ffa_row1_col23, #T_90ffa_row1_col24, #T_90ffa_row1_col25, #T_90ffa_row1_col26, #T_90ffa_row1_col27, #T_90ffa_row2_col0, #T_90ffa_row2_col1, #T_90ffa_row2_col2, #T_90ffa_row2_col3, #T_90ffa_row2_col4, #T_90ffa_row2_col5, #T_90ffa_row2_col6, #T_90ffa_row2_col7, #T_90ffa_row2_col8, #T_90ffa_row2_col9, #T_90ffa_row2_col10, #T_90ffa_row2_col11, #T_90ffa_row2_col12, #T_90ffa_row2_col13, #T_90ffa_row2_col14, #T_90ffa_row2_col15, #T_90ffa_row2_col16, #T_90ffa_row2_col17, #T_90ffa_row2_col18, #T_90ffa_row2_col19, #T_90ffa_row2_col20, #T_90ffa_row2_col21, #T_90ffa_row2_col22, #T_90ffa_row2_col23, #T_90ffa_row2_col24, #T_90ffa_row2_col25, #T_90ffa_row2_col26, #T_90ffa_row2_col27, #T_90ffa_row3_col0, #T_90ffa_row3_col1, #T_90ffa_row3_col2, #T_90ffa_row3_col3, #T_90ffa_row3_col4, #T_90ffa_row3_col5, #T_90ffa_row3_col6, #T_90ffa_row3_col7, #T_90ffa_row3_col8, #T_90ffa_row3_col9, #T_90ffa_row3_col10, #T_90ffa_row3_col11, #T_90ffa_row3_col12, #T_90ffa_row3_col13, #T_90ffa_row3_col14, #T_90ffa_row3_col15, #T_90ffa_row3_col16, #T_90ffa_row3_col17, #T_90ffa_row3_col18, #T_90ffa_row3_col19, #T_90ffa_row3_col20, #T_90ffa_row3_col21, #T_90ffa_row3_col22, #T_90ffa_row3_col23, #T_90ffa_row3_col24, #T_90ffa_row3_col25, #T_90ffa_row3_col26, #T_90ffa_row3_col27, #T_90ffa_row4_col0, #T_90ffa_row4_col1, #T_90ffa_row4_col2, #T_90ffa_row4_col3, #T_90ffa_row4_col4, #T_90ffa_row4_col5, #T_90ffa_row4_col6, #T_90ffa_row4_col7, #T_90ffa_row4_col8, #T_90ffa_row4_col9, #T_90ffa_row4_col10, #T_90ffa_row4_col11, #T_90ffa_row4_col12, #T_90ffa_row4_col13, #T_90ffa_row4_col14, #T_90ffa_row4_col15, #T_90ffa_row4_col16, #T_90ffa_row4_col17, #T_90ffa_row4_col18, #T_90ffa_row4_col19, #T_90ffa_row4_col20, #T_90ffa_row4_col21, #T_90ffa_row4_col22, #T_90ffa_row4_col23, #T_90ffa_row4_col24, #T_90ffa_row4_col25, #T_90ffa_row4_col26, #T_90ffa_row4_col27, #T_90ffa_row5_col0, #T_90ffa_row5_col1, #T_90ffa_row5_col2, #T_90ffa_row5_col16, #T_90ffa_row5_col17, #T_90ffa_row5_col18, #T_90ffa_row5_col19, #T_90ffa_row5_col20, #T_90ffa_row5_col21, #T_90ffa_row5_col22, #T_90ffa_row5_col23, #T_90ffa_row5_col24, #T_90ffa_row5_col25, #T_90ffa_row5_col26, #T_90ffa_row5_col27, #T_90ffa_row6_col0, #T_90ffa_row6_col1, #T_90ffa_row6_col2, #T_90ffa_row6_col19, #T_90ffa_row6_col20, #T_90ffa_row6_col21, #T_90ffa_row6_col22, #T_90ffa_row6_col23, #T_90ffa_row6_col24, #T_90ffa_row6_col25, #T_90ffa_row6_col26, #T_90ffa_row6_col27, #T_90ffa_row7_col0, #T_90ffa_row7_col1, #T_90ffa_row7_col2, #T_90ffa_row7_col19, #T_90ffa_row7_col20, #T_90ffa_row7_col21, #T_90ffa_row7_col22, #T_90ffa_row7_col23, #T_90ffa_row7_col24, #T_90ffa_row7_col25, #T_90ffa_row7_col26, #T_90ffa_row7_col27, #T_90ffa_row8_col0, #T_90ffa_row8_col1, #T_90ffa_row8_col2, #T_90ffa_row8_col8, #T_90ffa_row8_col9, #T_90ffa_row8_col10, #T_90ffa_row8_col11, #T_90ffa_row8_col12, #T_90ffa_row8_col13, #T_90ffa_row8_col19, #T_90ffa_row8_col20, #T_90ffa_row8_col21, #T_90ffa_row8_col22, #T_90ffa_row8_col23, #T_90ffa_row8_col24, #T_90ffa_row8_col25, #T_90ffa_row8_col26, #T_90ffa_row8_col27, #T_90ffa_row9_col0, #T_90ffa_row9_col1, #T_90ffa_row9_col2, #T_90ffa_row9_col3, #T_90ffa_row9_col4, #T_90ffa_row9_col5, #T_90ffa_row9_col6, #T_90ffa_row9_col7, #T_90ffa_row9_col8, #T_90ffa_row9_col9, #T_90ffa_row9_col10, #T_90ffa_row9_col11, #T_90ffa_row9_col12, #T_90ffa_row9_col13, #T_90ffa_row9_col19, #T_90ffa_row9_col20, #T_90ffa_row9_col21, #T_90ffa_row9_col22, #T_90ffa_row9_col23, #T_90ffa_row9_col24, #T_90ffa_row9_col25, #T_90ffa_row9_col26, #T_90ffa_row9_col27 {
  font-size: 6pt;
  background-color: #ffffff;
  color: #000000;
}
#T_90ffa_row5_col3, #T_90ffa_row8_col14 {
  font-size: 6pt;
  background-color: #f9f9f9;
  color: #000000;
}
#T_90ffa_row5_col4 {
  font-size: 6pt;
  background-color: #b9b9b9;
  color: #000000;
}
#T_90ffa_row5_col5 {
  font-size: 6pt;
  background-color: #c1c1c1;
  color: #000000;
}
#T_90ffa_row5_col6 {
  font-size: 6pt;
  background-color: #858585;
  color: #f1f1f1;
}
#T_90ffa_row5_col7, #T_90ffa_row5_col10, #T_90ffa_row5_col11, #T_90ffa_row5_col12, #T_90ffa_row5_col13 {
  font-size: 6pt;
  background-color: #777777;
  color: #f1f1f1;
}
#T_90ffa_row5_col8 {
  font-size: 6pt;
  background-color: #090909;
  color: #f1f1f1;
}
#T_90ffa_row5_col9 {
  font-size: 6pt;
  background-color: #5b5b5b;
  color: #f1f1f1;
}
#T_90ffa_row5_col14 {
  font-size: 6pt;
  background-color: #919191;
  color: #f1f1f1;
}
#T_90ffa_row5_col15 {
  font-size: 6pt;
  background-color: #e1e1e1;
  color: #000000;
}
#T_90ffa_row6_col3 {
  font-size: 6pt;
  background-color: #727272;
  color: #f1f1f1;
}
#T_90ffa_row6_col4, #T_90ffa_row6_col5, #T_90ffa_row6_col6, #T_90ffa_row6_col7, #T_90ffa_row6_col8, #T_90ffa_row6_col9, #T_90ffa_row6_col10, #T_90ffa_row6_col11, #T_90ffa_row6_col12, #T_90ffa_row6_col13, #T_90ffa_row6_col14, #T_90ffa_row7_col3, #T_90ffa_row7_col4, #T_90ffa_row7_col5, #T_90ffa_row7_col6, #T_90ffa_row7_col15, #T_90ffa_row7_col16, #T_90ffa_row7_col17, #T_90ffa_row8_col16, #T_90ffa_row8_col17, #T_90ffa_row8_col18, #T_90ffa_row9_col15, #T_90ffa_row9_col16 {
  font-size: 6pt;
  background-color: #000000;
  color: #f1f1f1;
}
#T_90ffa_row6_col15 {
  font-size: 6pt;
  background-color: #020202;
  color: #f1f1f1;
}
#T_90ffa_row6_col16 {
  font-size: 6pt;
  background-color: #363636;
  color: #f1f1f1;
}
#T_90ffa_row6_col17 {
  font-size: 6pt;
  background-color: #9d9d9d;
  color: #f1f1f1;
}
#T_90ffa_row6_col18 {
  font-size: 6pt;
  background-color: #dfdfdf;
  color: #000000;
}
#T_90ffa_row7_col7 {
  font-size: 6pt;
  background-color: #161616;
  color: #f1f1f1;
}
#T_90ffa_row7_col8, #T_90ffa_row7_col9, #T_90ffa_row7_col10, #T_90ffa_row7_col11, #T_90ffa_row7_col13 {
  font-size: 6pt;
  background-color: #535353;
  color: #f1f1f1;
}
#T_90ffa_row7_col12 {
  font-size: 6pt;
  background-color: #7c7c7c;
  color: #f1f1f1;
}
#T_90ffa_row7_col14 {
  font-size: 6pt;
  background-color: #3d3d3d;
  color: #f1f1f1;
}
#T_90ffa_row7_col18 {
  font-size: 6pt;
  background-color: #999999;
  color: #f1f1f1;
}
#T_90ffa_row8_col3 {
  font-size: 6pt;
  background-color: #eaeaea;
  color: #000000;
}
#T_90ffa_row8_col4 {
  font-size: 6pt;
  background-color: #d0d0d0;
  color: #000000;
}
#T_90ffa_row8_col5, #T_90ffa_row8_col6 {
  font-size: 6pt;
  background-color: #eeeeee;
  color: #000000;
}
#T_90ffa_row8_col7 {
  font-size: 6pt;
  background-color: #f3f3f3;
  color: #000000;
}
#T_90ffa_row8_col15 {
  font-size: 6pt;
  background-color: #232323;
  color: #f1f1f1;
}
#T_90ffa_row9_col14 {
  font-size: 6pt;
  background-color: #c2c2c2;
  color: #000000;
}
#T_90ffa_row9_col17 {
  font-size: 6pt;
  background-color: #080808;
  color: #f1f1f1;
}
#T_90ffa_row9_col18 {
  font-size: 6pt;
  background-color: #c4c4c4;
  color: #000000;
}
</style>

<table id="T_90ffa" class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_90ffa_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">0</th>
<th id="T_90ffa_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">1</th>
<th id="T_90ffa_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">2</th>
<th id="T_90ffa_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">3</th>
<th id="T_90ffa_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">4</th>
<th id="T_90ffa_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">5</th>
<th id="T_90ffa_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">6</th>
<th id="T_90ffa_level0_col7" class="col_heading level0 col7" data-quarto-table-cell-role="th">7</th>
<th id="T_90ffa_level0_col8" class="col_heading level0 col8" data-quarto-table-cell-role="th">8</th>
<th id="T_90ffa_level0_col9" class="col_heading level0 col9" data-quarto-table-cell-role="th">9</th>
<th id="T_90ffa_level0_col10" class="col_heading level0 col10" data-quarto-table-cell-role="th">10</th>
<th id="T_90ffa_level0_col11" class="col_heading level0 col11" data-quarto-table-cell-role="th">11</th>
<th id="T_90ffa_level0_col12" class="col_heading level0 col12" data-quarto-table-cell-role="th">12</th>
<th id="T_90ffa_level0_col13" class="col_heading level0 col13" data-quarto-table-cell-role="th">13</th>
<th id="T_90ffa_level0_col14" class="col_heading level0 col14" data-quarto-table-cell-role="th">14</th>
<th id="T_90ffa_level0_col15" class="col_heading level0 col15" data-quarto-table-cell-role="th">15</th>
<th id="T_90ffa_level0_col16" class="col_heading level0 col16" data-quarto-table-cell-role="th">16</th>
<th id="T_90ffa_level0_col17" class="col_heading level0 col17" data-quarto-table-cell-role="th">17</th>
<th id="T_90ffa_level0_col18" class="col_heading level0 col18" data-quarto-table-cell-role="th">18</th>
<th id="T_90ffa_level0_col19" class="col_heading level0 col19" data-quarto-table-cell-role="th">19</th>
<th id="T_90ffa_level0_col20" class="col_heading level0 col20" data-quarto-table-cell-role="th">20</th>
<th id="T_90ffa_level0_col21" class="col_heading level0 col21" data-quarto-table-cell-role="th">21</th>
<th id="T_90ffa_level0_col22" class="col_heading level0 col22" data-quarto-table-cell-role="th">22</th>
<th id="T_90ffa_level0_col23" class="col_heading level0 col23" data-quarto-table-cell-role="th">23</th>
<th id="T_90ffa_level0_col24" class="col_heading level0 col24" data-quarto-table-cell-role="th">24</th>
<th id="T_90ffa_level0_col25" class="col_heading level0 col25" data-quarto-table-cell-role="th">25</th>
<th id="T_90ffa_level0_col26" class="col_heading level0 col26" data-quarto-table-cell-role="th">26</th>
<th id="T_90ffa_level0_col27" class="col_heading level0 col27" data-quarto-table-cell-role="th">27</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_90ffa_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">0</td>
<td id="T_90ffa_row0_col0" class="data row0 col0">0</td>
<td id="T_90ffa_row0_col1" class="data row0 col1">0</td>
<td id="T_90ffa_row0_col2" class="data row0 col2">0</td>
<td id="T_90ffa_row0_col3" class="data row0 col3">0</td>
<td id="T_90ffa_row0_col4" class="data row0 col4">0</td>
<td id="T_90ffa_row0_col5" class="data row0 col5">0</td>
<td id="T_90ffa_row0_col6" class="data row0 col6">0</td>
<td id="T_90ffa_row0_col7" class="data row0 col7">0</td>
<td id="T_90ffa_row0_col8" class="data row0 col8">0</td>
<td id="T_90ffa_row0_col9" class="data row0 col9">0</td>
<td id="T_90ffa_row0_col10" class="data row0 col10">0</td>
<td id="T_90ffa_row0_col11" class="data row0 col11">0</td>
<td id="T_90ffa_row0_col12" class="data row0 col12">0</td>
<td id="T_90ffa_row0_col13" class="data row0 col13">0</td>
<td id="T_90ffa_row0_col14" class="data row0 col14">0</td>
<td id="T_90ffa_row0_col15" class="data row0 col15">0</td>
<td id="T_90ffa_row0_col16" class="data row0 col16">0</td>
<td id="T_90ffa_row0_col17" class="data row0 col17">0</td>
<td id="T_90ffa_row0_col18" class="data row0 col18">0</td>
<td id="T_90ffa_row0_col19" class="data row0 col19">0</td>
<td id="T_90ffa_row0_col20" class="data row0 col20">0</td>
<td id="T_90ffa_row0_col21" class="data row0 col21">0</td>
<td id="T_90ffa_row0_col22" class="data row0 col22">0</td>
<td id="T_90ffa_row0_col23" class="data row0 col23">0</td>
<td id="T_90ffa_row0_col24" class="data row0 col24">0</td>
<td id="T_90ffa_row0_col25" class="data row0 col25">0</td>
<td id="T_90ffa_row0_col26" class="data row0 col26">0</td>
<td id="T_90ffa_row0_col27" class="data row0 col27">0</td>
</tr>
<tr class="even">
<td id="T_90ffa_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">1</td>
<td id="T_90ffa_row1_col0" class="data row1 col0">0</td>
<td id="T_90ffa_row1_col1" class="data row1 col1">0</td>
<td id="T_90ffa_row1_col2" class="data row1 col2">0</td>
<td id="T_90ffa_row1_col3" class="data row1 col3">0</td>
<td id="T_90ffa_row1_col4" class="data row1 col4">0</td>
<td id="T_90ffa_row1_col5" class="data row1 col5">0</td>
<td id="T_90ffa_row1_col6" class="data row1 col6">0</td>
<td id="T_90ffa_row1_col7" class="data row1 col7">0</td>
<td id="T_90ffa_row1_col8" class="data row1 col8">0</td>
<td id="T_90ffa_row1_col9" class="data row1 col9">0</td>
<td id="T_90ffa_row1_col10" class="data row1 col10">0</td>
<td id="T_90ffa_row1_col11" class="data row1 col11">0</td>
<td id="T_90ffa_row1_col12" class="data row1 col12">0</td>
<td id="T_90ffa_row1_col13" class="data row1 col13">0</td>
<td id="T_90ffa_row1_col14" class="data row1 col14">0</td>
<td id="T_90ffa_row1_col15" class="data row1 col15">0</td>
<td id="T_90ffa_row1_col16" class="data row1 col16">0</td>
<td id="T_90ffa_row1_col17" class="data row1 col17">0</td>
<td id="T_90ffa_row1_col18" class="data row1 col18">0</td>
<td id="T_90ffa_row1_col19" class="data row1 col19">0</td>
<td id="T_90ffa_row1_col20" class="data row1 col20">0</td>
<td id="T_90ffa_row1_col21" class="data row1 col21">0</td>
<td id="T_90ffa_row1_col22" class="data row1 col22">0</td>
<td id="T_90ffa_row1_col23" class="data row1 col23">0</td>
<td id="T_90ffa_row1_col24" class="data row1 col24">0</td>
<td id="T_90ffa_row1_col25" class="data row1 col25">0</td>
<td id="T_90ffa_row1_col26" class="data row1 col26">0</td>
<td id="T_90ffa_row1_col27" class="data row1 col27">0</td>
</tr>
<tr class="odd">
<td id="T_90ffa_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">2</td>
<td id="T_90ffa_row2_col0" class="data row2 col0">0</td>
<td id="T_90ffa_row2_col1" class="data row2 col1">0</td>
<td id="T_90ffa_row2_col2" class="data row2 col2">0</td>
<td id="T_90ffa_row2_col3" class="data row2 col3">0</td>
<td id="T_90ffa_row2_col4" class="data row2 col4">0</td>
<td id="T_90ffa_row2_col5" class="data row2 col5">0</td>
<td id="T_90ffa_row2_col6" class="data row2 col6">0</td>
<td id="T_90ffa_row2_col7" class="data row2 col7">0</td>
<td id="T_90ffa_row2_col8" class="data row2 col8">0</td>
<td id="T_90ffa_row2_col9" class="data row2 col9">0</td>
<td id="T_90ffa_row2_col10" class="data row2 col10">0</td>
<td id="T_90ffa_row2_col11" class="data row2 col11">0</td>
<td id="T_90ffa_row2_col12" class="data row2 col12">0</td>
<td id="T_90ffa_row2_col13" class="data row2 col13">0</td>
<td id="T_90ffa_row2_col14" class="data row2 col14">0</td>
<td id="T_90ffa_row2_col15" class="data row2 col15">0</td>
<td id="T_90ffa_row2_col16" class="data row2 col16">0</td>
<td id="T_90ffa_row2_col17" class="data row2 col17">0</td>
<td id="T_90ffa_row2_col18" class="data row2 col18">0</td>
<td id="T_90ffa_row2_col19" class="data row2 col19">0</td>
<td id="T_90ffa_row2_col20" class="data row2 col20">0</td>
<td id="T_90ffa_row2_col21" class="data row2 col21">0</td>
<td id="T_90ffa_row2_col22" class="data row2 col22">0</td>
<td id="T_90ffa_row2_col23" class="data row2 col23">0</td>
<td id="T_90ffa_row2_col24" class="data row2 col24">0</td>
<td id="T_90ffa_row2_col25" class="data row2 col25">0</td>
<td id="T_90ffa_row2_col26" class="data row2 col26">0</td>
<td id="T_90ffa_row2_col27" class="data row2 col27">0</td>
</tr>
<tr class="even">
<td id="T_90ffa_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">3</td>
<td id="T_90ffa_row3_col0" class="data row3 col0">0</td>
<td id="T_90ffa_row3_col1" class="data row3 col1">0</td>
<td id="T_90ffa_row3_col2" class="data row3 col2">0</td>
<td id="T_90ffa_row3_col3" class="data row3 col3">0</td>
<td id="T_90ffa_row3_col4" class="data row3 col4">0</td>
<td id="T_90ffa_row3_col5" class="data row3 col5">0</td>
<td id="T_90ffa_row3_col6" class="data row3 col6">0</td>
<td id="T_90ffa_row3_col7" class="data row3 col7">0</td>
<td id="T_90ffa_row3_col8" class="data row3 col8">0</td>
<td id="T_90ffa_row3_col9" class="data row3 col9">0</td>
<td id="T_90ffa_row3_col10" class="data row3 col10">0</td>
<td id="T_90ffa_row3_col11" class="data row3 col11">0</td>
<td id="T_90ffa_row3_col12" class="data row3 col12">0</td>
<td id="T_90ffa_row3_col13" class="data row3 col13">0</td>
<td id="T_90ffa_row3_col14" class="data row3 col14">0</td>
<td id="T_90ffa_row3_col15" class="data row3 col15">0</td>
<td id="T_90ffa_row3_col16" class="data row3 col16">0</td>
<td id="T_90ffa_row3_col17" class="data row3 col17">0</td>
<td id="T_90ffa_row3_col18" class="data row3 col18">0</td>
<td id="T_90ffa_row3_col19" class="data row3 col19">0</td>
<td id="T_90ffa_row3_col20" class="data row3 col20">0</td>
<td id="T_90ffa_row3_col21" class="data row3 col21">0</td>
<td id="T_90ffa_row3_col22" class="data row3 col22">0</td>
<td id="T_90ffa_row3_col23" class="data row3 col23">0</td>
<td id="T_90ffa_row3_col24" class="data row3 col24">0</td>
<td id="T_90ffa_row3_col25" class="data row3 col25">0</td>
<td id="T_90ffa_row3_col26" class="data row3 col26">0</td>
<td id="T_90ffa_row3_col27" class="data row3 col27">0</td>
</tr>
<tr class="odd">
<td id="T_90ffa_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">4</td>
<td id="T_90ffa_row4_col0" class="data row4 col0">0</td>
<td id="T_90ffa_row4_col1" class="data row4 col1">0</td>
<td id="T_90ffa_row4_col2" class="data row4 col2">0</td>
<td id="T_90ffa_row4_col3" class="data row4 col3">0</td>
<td id="T_90ffa_row4_col4" class="data row4 col4">0</td>
<td id="T_90ffa_row4_col5" class="data row4 col5">0</td>
<td id="T_90ffa_row4_col6" class="data row4 col6">0</td>
<td id="T_90ffa_row4_col7" class="data row4 col7">0</td>
<td id="T_90ffa_row4_col8" class="data row4 col8">0</td>
<td id="T_90ffa_row4_col9" class="data row4 col9">0</td>
<td id="T_90ffa_row4_col10" class="data row4 col10">0</td>
<td id="T_90ffa_row4_col11" class="data row4 col11">0</td>
<td id="T_90ffa_row4_col12" class="data row4 col12">0</td>
<td id="T_90ffa_row4_col13" class="data row4 col13">0</td>
<td id="T_90ffa_row4_col14" class="data row4 col14">0</td>
<td id="T_90ffa_row4_col15" class="data row4 col15">0</td>
<td id="T_90ffa_row4_col16" class="data row4 col16">0</td>
<td id="T_90ffa_row4_col17" class="data row4 col17">0</td>
<td id="T_90ffa_row4_col18" class="data row4 col18">0</td>
<td id="T_90ffa_row4_col19" class="data row4 col19">0</td>
<td id="T_90ffa_row4_col20" class="data row4 col20">0</td>
<td id="T_90ffa_row4_col21" class="data row4 col21">0</td>
<td id="T_90ffa_row4_col22" class="data row4 col22">0</td>
<td id="T_90ffa_row4_col23" class="data row4 col23">0</td>
<td id="T_90ffa_row4_col24" class="data row4 col24">0</td>
<td id="T_90ffa_row4_col25" class="data row4 col25">0</td>
<td id="T_90ffa_row4_col26" class="data row4 col26">0</td>
<td id="T_90ffa_row4_col27" class="data row4 col27">0</td>
</tr>
<tr class="even">
<td id="T_90ffa_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">5</td>
<td id="T_90ffa_row5_col0" class="data row5 col0">0</td>
<td id="T_90ffa_row5_col1" class="data row5 col1">0</td>
<td id="T_90ffa_row5_col2" class="data row5 col2">0</td>
<td id="T_90ffa_row5_col3" class="data row5 col3">12</td>
<td id="T_90ffa_row5_col4" class="data row5 col4">99</td>
<td id="T_90ffa_row5_col5" class="data row5 col5">91</td>
<td id="T_90ffa_row5_col6" class="data row5 col6">142</td>
<td id="T_90ffa_row5_col7" class="data row5 col7">155</td>
<td id="T_90ffa_row5_col8" class="data row5 col8">246</td>
<td id="T_90ffa_row5_col9" class="data row5 col9">182</td>
<td id="T_90ffa_row5_col10" class="data row5 col10">155</td>
<td id="T_90ffa_row5_col11" class="data row5 col11">155</td>
<td id="T_90ffa_row5_col12" class="data row5 col12">155</td>
<td id="T_90ffa_row5_col13" class="data row5 col13">155</td>
<td id="T_90ffa_row5_col14" class="data row5 col14">131</td>
<td id="T_90ffa_row5_col15" class="data row5 col15">52</td>
<td id="T_90ffa_row5_col16" class="data row5 col16">0</td>
<td id="T_90ffa_row5_col17" class="data row5 col17">0</td>
<td id="T_90ffa_row5_col18" class="data row5 col18">0</td>
<td id="T_90ffa_row5_col19" class="data row5 col19">0</td>
<td id="T_90ffa_row5_col20" class="data row5 col20">0</td>
<td id="T_90ffa_row5_col21" class="data row5 col21">0</td>
<td id="T_90ffa_row5_col22" class="data row5 col22">0</td>
<td id="T_90ffa_row5_col23" class="data row5 col23">0</td>
<td id="T_90ffa_row5_col24" class="data row5 col24">0</td>
<td id="T_90ffa_row5_col25" class="data row5 col25">0</td>
<td id="T_90ffa_row5_col26" class="data row5 col26">0</td>
<td id="T_90ffa_row5_col27" class="data row5 col27">0</td>
</tr>
<tr class="odd">
<td id="T_90ffa_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">6</td>
<td id="T_90ffa_row6_col0" class="data row6 col0">0</td>
<td id="T_90ffa_row6_col1" class="data row6 col1">0</td>
<td id="T_90ffa_row6_col2" class="data row6 col2">0</td>
<td id="T_90ffa_row6_col3" class="data row6 col3">138</td>
<td id="T_90ffa_row6_col4" class="data row6 col4">254</td>
<td id="T_90ffa_row6_col5" class="data row6 col5">254</td>
<td id="T_90ffa_row6_col6" class="data row6 col6">254</td>
<td id="T_90ffa_row6_col7" class="data row6 col7">254</td>
<td id="T_90ffa_row6_col8" class="data row6 col8">254</td>
<td id="T_90ffa_row6_col9" class="data row6 col9">254</td>
<td id="T_90ffa_row6_col10" class="data row6 col10">254</td>
<td id="T_90ffa_row6_col11" class="data row6 col11">254</td>
<td id="T_90ffa_row6_col12" class="data row6 col12">254</td>
<td id="T_90ffa_row6_col13" class="data row6 col13">254</td>
<td id="T_90ffa_row6_col14" class="data row6 col14">254</td>
<td id="T_90ffa_row6_col15" class="data row6 col15">252</td>
<td id="T_90ffa_row6_col16" class="data row6 col16">210</td>
<td id="T_90ffa_row6_col17" class="data row6 col17">122</td>
<td id="T_90ffa_row6_col18" class="data row6 col18">33</td>
<td id="T_90ffa_row6_col19" class="data row6 col19">0</td>
<td id="T_90ffa_row6_col20" class="data row6 col20">0</td>
<td id="T_90ffa_row6_col21" class="data row6 col21">0</td>
<td id="T_90ffa_row6_col22" class="data row6 col22">0</td>
<td id="T_90ffa_row6_col23" class="data row6 col23">0</td>
<td id="T_90ffa_row6_col24" class="data row6 col24">0</td>
<td id="T_90ffa_row6_col25" class="data row6 col25">0</td>
<td id="T_90ffa_row6_col26" class="data row6 col26">0</td>
<td id="T_90ffa_row6_col27" class="data row6 col27">0</td>
</tr>
<tr class="even">
<td id="T_90ffa_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">7</td>
<td id="T_90ffa_row7_col0" class="data row7 col0">0</td>
<td id="T_90ffa_row7_col1" class="data row7 col1">0</td>
<td id="T_90ffa_row7_col2" class="data row7 col2">0</td>
<td id="T_90ffa_row7_col3" class="data row7 col3">220</td>
<td id="T_90ffa_row7_col4" class="data row7 col4">254</td>
<td id="T_90ffa_row7_col5" class="data row7 col5">254</td>
<td id="T_90ffa_row7_col6" class="data row7 col6">254</td>
<td id="T_90ffa_row7_col7" class="data row7 col7">235</td>
<td id="T_90ffa_row7_col8" class="data row7 col8">189</td>
<td id="T_90ffa_row7_col9" class="data row7 col9">189</td>
<td id="T_90ffa_row7_col10" class="data row7 col10">189</td>
<td id="T_90ffa_row7_col11" class="data row7 col11">189</td>
<td id="T_90ffa_row7_col12" class="data row7 col12">150</td>
<td id="T_90ffa_row7_col13" class="data row7 col13">189</td>
<td id="T_90ffa_row7_col14" class="data row7 col14">205</td>
<td id="T_90ffa_row7_col15" class="data row7 col15">254</td>
<td id="T_90ffa_row7_col16" class="data row7 col16">254</td>
<td id="T_90ffa_row7_col17" class="data row7 col17">254</td>
<td id="T_90ffa_row7_col18" class="data row7 col18">75</td>
<td id="T_90ffa_row7_col19" class="data row7 col19">0</td>
<td id="T_90ffa_row7_col20" class="data row7 col20">0</td>
<td id="T_90ffa_row7_col21" class="data row7 col21">0</td>
<td id="T_90ffa_row7_col22" class="data row7 col22">0</td>
<td id="T_90ffa_row7_col23" class="data row7 col23">0</td>
<td id="T_90ffa_row7_col24" class="data row7 col24">0</td>
<td id="T_90ffa_row7_col25" class="data row7 col25">0</td>
<td id="T_90ffa_row7_col26" class="data row7 col26">0</td>
<td id="T_90ffa_row7_col27" class="data row7 col27">0</td>
</tr>
<tr class="odd">
<td id="T_90ffa_level0_row8" class="row_heading level0 row8" data-quarto-table-cell-role="th">8</td>
<td id="T_90ffa_row8_col0" class="data row8 col0">0</td>
<td id="T_90ffa_row8_col1" class="data row8 col1">0</td>
<td id="T_90ffa_row8_col2" class="data row8 col2">0</td>
<td id="T_90ffa_row8_col3" class="data row8 col3">35</td>
<td id="T_90ffa_row8_col4" class="data row8 col4">74</td>
<td id="T_90ffa_row8_col5" class="data row8 col5">35</td>
<td id="T_90ffa_row8_col6" class="data row8 col6">35</td>
<td id="T_90ffa_row8_col7" class="data row8 col7">25</td>
<td id="T_90ffa_row8_col8" class="data row8 col8">0</td>
<td id="T_90ffa_row8_col9" class="data row8 col9">0</td>
<td id="T_90ffa_row8_col10" class="data row8 col10">0</td>
<td id="T_90ffa_row8_col11" class="data row8 col11">0</td>
<td id="T_90ffa_row8_col12" class="data row8 col12">0</td>
<td id="T_90ffa_row8_col13" class="data row8 col13">0</td>
<td id="T_90ffa_row8_col14" class="data row8 col14">13</td>
<td id="T_90ffa_row8_col15" class="data row8 col15">224</td>
<td id="T_90ffa_row8_col16" class="data row8 col16">254</td>
<td id="T_90ffa_row8_col17" class="data row8 col17">254</td>
<td id="T_90ffa_row8_col18" class="data row8 col18">153</td>
<td id="T_90ffa_row8_col19" class="data row8 col19">0</td>
<td id="T_90ffa_row8_col20" class="data row8 col20">0</td>
<td id="T_90ffa_row8_col21" class="data row8 col21">0</td>
<td id="T_90ffa_row8_col22" class="data row8 col22">0</td>
<td id="T_90ffa_row8_col23" class="data row8 col23">0</td>
<td id="T_90ffa_row8_col24" class="data row8 col24">0</td>
<td id="T_90ffa_row8_col25" class="data row8 col25">0</td>
<td id="T_90ffa_row8_col26" class="data row8 col26">0</td>
<td id="T_90ffa_row8_col27" class="data row8 col27">0</td>
</tr>
<tr class="even">
<td id="T_90ffa_level0_row9" class="row_heading level0 row9" data-quarto-table-cell-role="th">9</td>
<td id="T_90ffa_row9_col0" class="data row9 col0">0</td>
<td id="T_90ffa_row9_col1" class="data row9 col1">0</td>
<td id="T_90ffa_row9_col2" class="data row9 col2">0</td>
<td id="T_90ffa_row9_col3" class="data row9 col3">0</td>
<td id="T_90ffa_row9_col4" class="data row9 col4">0</td>
<td id="T_90ffa_row9_col5" class="data row9 col5">0</td>
<td id="T_90ffa_row9_col6" class="data row9 col6">0</td>
<td id="T_90ffa_row9_col7" class="data row9 col7">0</td>
<td id="T_90ffa_row9_col8" class="data row9 col8">0</td>
<td id="T_90ffa_row9_col9" class="data row9 col9">0</td>
<td id="T_90ffa_row9_col10" class="data row9 col10">0</td>
<td id="T_90ffa_row9_col11" class="data row9 col11">0</td>
<td id="T_90ffa_row9_col12" class="data row9 col12">0</td>
<td id="T_90ffa_row9_col13" class="data row9 col13">0</td>
<td id="T_90ffa_row9_col14" class="data row9 col14">90</td>
<td id="T_90ffa_row9_col15" class="data row9 col15">254</td>
<td id="T_90ffa_row9_col16" class="data row9 col16">254</td>
<td id="T_90ffa_row9_col17" class="data row9 col17">247</td>
<td id="T_90ffa_row9_col18" class="data row9 col18">53</td>
<td id="T_90ffa_row9_col19" class="data row9 col19">0</td>
<td id="T_90ffa_row9_col20" class="data row9 col20">0</td>
<td id="T_90ffa_row9_col21" class="data row9 col21">0</td>
<td id="T_90ffa_row9_col22" class="data row9 col22">0</td>
<td id="T_90ffa_row9_col23" class="data row9 col23">0</td>
<td id="T_90ffa_row9_col24" class="data row9 col24">0</td>
<td id="T_90ffa_row9_col25" class="data row9 col25">0</td>
<td id="T_90ffa_row9_col26" class="data row9 col26">0</td>
<td id="T_90ffa_row9_col27" class="data row9 col27">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s define a kernel that detects horizontal edges in the image. The kernel is a 3x3 matrix with values that are designed to highlight horizontal edges.</p>
<div id="1bb09ffd" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> tensor([[<span class="op">-</span><span class="fl">1.</span>, <span class="op">-</span><span class="fl">1.</span>, <span class="op">-</span><span class="fl">1.</span>],</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                 [ <span class="fl">0.</span>,  <span class="fl">0.</span>,  <span class="fl">0.</span>],</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                 [ <span class="fl">1.</span>,  <span class="fl">1.</span>,  <span class="fl">1.</span>]]).<span class="bu">float</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This kernel will detect horizontal edges in the image by emphasizing the differences between the pixel values in the top and bottom rows of the kernel, we can also change the kernel to have the row of 1s at the top and -1s at the bottom, we can detect horizontal edges that go from dark to light, putting 1s and -1s in columns versus rows give us filters that detect vertical edges.</p>
<div id="4b3acd99" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_kernel(row, col, kernel):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (im3_t[row<span class="op">-</span><span class="dv">1</span>:row<span class="op">+</span><span class="dv">2</span>,col<span class="op">-</span><span class="dv">1</span>:col<span class="op">+</span><span class="dv">2</span>] <span class="op">*</span> kernel).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For a more in-depth guide to convolution arithmetic, see <span class="citation" data-cites="dumoulin2016guide">Dumoulin and Visin (<a href="#ref-dumoulin2016guide" role="doc-biblioref">2016</a>)</span>.</p>
</section>
<section id="strides-and-padding" class="level2">
<h2 class="anchored" data-anchor-id="strides-and-padding">Strides and Padding</h2>
<p>With convolution arithmetic, the kernel is applied to each pixel in the image, resulting in a new feature map that the dimensions are smaller than the original image. This is because the kernel cannot be applied to the pixels at the edges of the image. To address this issue, we can use two techniques: <strong>strides</strong> and <strong>padding</strong>.</p>
<p><strong>Strides</strong> refer to the number of pixels by which we move the kernel across the image. By default, the stride is set to 1, meaning we move the kernel one pixel at a time. However, we can increase the stride to reduce the size of the output feature map. For example, if we set the stride to 2, the kernel will move two pixels at a time, resulting in a smaller output feature map.</p>
<p><strong>Padding</strong> involves adding extra pixels around the edges of the image before applying the kernel. This allows us to preserve the spatial dimensions of the input image in the output feature map. There are different types of padding, such as zero-padding (adding zeros) and reflection padding (adding a mirror image of the border pixels).</p>
<div id="fig-padding" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-padding-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./imgs/padding.png" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-padding-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: An example of padding with stride of 2
</figcaption>
</figure>
</div>
<p>As illustrated in <a href="#fig-padding" class="quarto-xref">Figure&nbsp;2</a>, a 5x5 input image is padded with a 2-pixel border of zeros, resulting in a 7x7 padded image. A 4x4 kernel is then applied to the padded image with a stride of 1, resulting in a 5x5 output feature map.</p>
<p>In general, if we add a kernel of size <span class="math inline">\(ks \times ks\)</span> (<span class="math inline">\(ks\)</span> is an odd number) to an input image of size <span class="math inline">\(n \times n\)</span>, the neccessary padding <span class="math inline">\(p\)</span> to preserve the spatial dimensions of the input image in the output feature map is given by: <span class="math display">\[
p = ks//2
\]</span> When <span class="math inline">\(ks\)</span> is even, we can use asymmetric padding, for example, if <span class="math inline">\(ks=4\)</span>, we can use <span class="math inline">\(p=(ks//2, ks//2-1)\)</span>.</p>
<p>Furthermore, if we apply the kernel with a stride of <span class="math inline">\(s\)</span>, the output feature map will have dimensions: <span class="math display">\[
\text{output size} = (n + 2p - ks)//(s) + 1
\]</span></p>
</section>
<section id="create-a-convolution-layer-with-pytorch" class="level2">
<h2 class="anchored" data-anchor-id="create-a-convolution-layer-with-pytorch">Create a Convolution Layer with PyTorch</h2>
<p>We can create a convolution layer using PyTorch’s <code>nn.Conv2d</code> class. The <code>nn.Conv2d</code> class takes several parameters, including the number of input channels, the number of output channels, the kernel size, the stride, and the padding.</p>
<p>In this example, we create a convolution layer with 1 input channel (grayscale image), 30 output channels (feature maps), a kernel size of 3x3, a stride of 1, and padding of 1. We also apply the ReLU activation function after the first convolution layer. One interesting property to note here is that we do not need to specify the input size when creating the convolution layer because a convolution is applied over each pixel automatically.</p>
<p>When creating <code>cnn</code> as above, we see that the output shape is the same as the input shape, which is (28, 28) (This is because we have used padding to preserve the spatial dimensions of the input image in the output feature map). It is not interesting for classification task since we need only single output activation per input image.</p>
<p>To deal with this, we can use several stride-2 convolution layers to reduce the spatial dimensions of the input image in the output feature map. For example, we can use two stride-2 convolution layers to reduce the spatial dimensions of the input image from (28, 28) to (7, 7), (4x4), (2x2) and then 1.</p>
<div id="fcb60f69" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> conv(ni, nf, ks<span class="op">=</span><span class="dv">3</span>, act<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> nn.Conv2d(ni, nf, stride<span class="op">=</span><span class="dv">2</span>, kernel_size<span class="op">=</span>ks, padding<span class="op">=</span>ks<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> act: res <span class="op">=</span> nn.Sequential(res, nn.ReLU()) </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, a simple <code>cnn</code> can be defined as follows:</p>
<div id="0e1f8840" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>simple_cnn <span class="op">=</span> sequential(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    conv(<span class="dv">1</span>, <span class="dv">4</span>),   <span class="co"># Input: 28x28 -&gt; Output: 14x14</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    conv(<span class="dv">4</span>, <span class="dv">8</span>),  <span class="co"># Input: 14x14 -&gt; Output: 7x7</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    conv(<span class="dv">8</span>, <span class="dv">16</span>), <span class="co"># Input: 7x7 -&gt; Output: 4x4</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    conv(<span class="dv">16</span>, <span class="dv">32</span>), <span class="co"># Input: 4x4 -&gt; Output: 2x2</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    conv(<span class="dv">32</span>, <span class="dv">2</span>, act<span class="op">=</span><span class="va">False</span>), <span class="co"># Input: 2x2 -&gt; Output: 1x1</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    Flatten()</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Our <code>Leaner</code> which is built from <code>simple_cnn</code> and dataset <code>dls</code> can be given as follows:</p>
<div id="937fd934" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> Learner(dls, simple_cnn, loss_func<span class="op">=</span>F.cross_entropy, metrics<span class="op">=</span>accuracy)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>learn.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Sequential (Input shape: 64 x 1 x 28 x 28)
============================================================================
Layer (type)         Output Shape         Param #    Trainable 
============================================================================
                     64 x 4 x 14 x 14    
Conv2d                                    40         True      
ReLU                                                           
____________________________________________________________________________
                     64 x 8 x 7 x 7      
Conv2d                                    296        True      
ReLU                                                           
____________________________________________________________________________
                     64 x 16 x 4 x 4     
Conv2d                                    1168       True      
ReLU                                                           
____________________________________________________________________________
                     64 x 32 x 2 x 2     
Conv2d                                    4640       True      
ReLU                                                           
____________________________________________________________________________
                     64 x 2 x 1 x 1      
Conv2d                                    578        True      
____________________________________________________________________________
                     64 x 2              
Flatten                                                        
____________________________________________________________________________

Total params: 6,722
Total trainable params: 6,722
Total non-trainable params: 0

Optimizer used: &lt;function Adam at 0x7f02af32d9e0&gt;
Loss function: &lt;function cross_entropy at 0x7f0337dc5080&gt;

Callbacks:
  - TrainEvalCallback
  - CastToTensor
  - Recorder
  - ProgressCallback</code></pre>
</div>
</div>
<p>As we can see, the output of the final Conv2D layer is 64x2x1x1, that’s why we need to flatten it before passing it to the final classification layer.</p>
<p>Afterwards, let’s train the model with low learning rate and more epochs to see how well it performs.</p>
<div id="1e8bb505" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>learn.fit_one_cycle(<span class="dv">2</span>, <span class="fl">1e-2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.067613</td>
<td>0.053133</td>
<td>0.982336</td>
<td>00:01</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.023864</td>
<td>0.029960</td>
<td>0.988714</td>
<td>00:01</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Impressive, we are able to achieve over 99% accuracy on the classification task with MNIST dataset using simple CNN architecture (built from scratch).</p>
</section>
<section id="improving-training-stability" class="level2">
<h2 class="anchored" data-anchor-id="improving-training-stability">Improving Training Stability</h2>
<section id="increase-batch-size" class="level3">
<h3 class="anchored" data-anchor-id="increase-batch-size">Increase Batch Size</h3>
</section>
<section id="learning-rate-finder" class="level3">
<h3 class="anchored" data-anchor-id="learning-rate-finder">Learning Rate Finder</h3>
</section>
<section id="batch-normalization" class="level3">
<h3 class="anchored" data-anchor-id="batch-normalization">Batch Normalization</h3>
</section>
</section>
</section>
<section id="residual-networks-resnet" class="level1">
<h1>Residual Networks (ResNet)</h1>
</section>
<section id="conclusions" class="level1">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Conclusions</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-dumoulin2016guide" class="csl-entry" role="listitem">
Dumoulin, Vincent, and Francesco Visin. 2016. <span>“A Guide to Convolution Arithmetic for Deep Learning.”</span> <a href="https://arxiv.org/abs/1603.07285">https://arxiv.org/abs/1603.07285</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/dnlam\.github\.io\/blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>